<!-- templates/messaging/chat.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}
    {% if conversation.type == 'group' %}{{ conversation.name }}{% else %}{{ other_user.username }}{% endif %} â€¢ Chat
{% endblock %}

{% block content %}
<div class="h-screen flex flex-col bg-gray-100 dark:bg-gray-900">
    <!-- Chat Header -->
    <div class="bg-white dark:bg-gray-800 shadow-xl border-b border-gray-200 dark:border-gray-700 px-6 py-5 flex items-center space-x-5">
        <a href="{% url 'inbox' %}" class="lg:hidden">
            <i class="fas fa-arrow-left text-2xl text-indigo-600"></i>
        </a>
        {% if conversation.type == 'group' %}
            <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center text-2xl font-bold text-white shadow-xl">
                {{ conversation.name|slice:":2"|upper }}
            </div>
            <div>
                <h2 class="text-2xl font-bold">{{ conversation.name }}</h2>
                <p class="text-sm text-gray-500">{{ conversation.participants.count }} members</p>
            </div>
        {% else %}
            <img src="{{ other_user.profile.avatar.url }}" class="w-14 h-14 rounded-2xl ring-4 ring-indigo-500/30 shadow-xl">
            <div>
                <h2 class="text-2xl font-bold">{{ other_user.get_full_name|default:other_user.username }}</h2>
                <p class="text-sm text-green-600 font-bold">Online</p>
            </div>
        {% endif %}
    </div>

    <!-- Messages Area -->
    <div class="flex-1 overflow-y-auto p-6 space-y-6" id="messages-container">
        {% for msg in messages %}
        <div class="{% if msg.sender == request.user %}ml-auto max-w-md text-right{% else %}mr-auto max-w-md{% endif %}">
            <div class="inline-block">
                <div class="bg-white dark:bg-gray-800 rounded-3xl px-6 py-4 shadow-lg">
                    {% if msg.sender != request.user %}
                        <p class="text-indigo-600 font-bold text-sm mb-1">{{ msg.sender.username }}</p>
                    {% endif %}
                    {% if msg.content %}
                        <p class="text-lg text-gray-800 dark:text-gray-200">{{ msg.content|linebreaks }}</p>
                    {% endif %}
                    {% if msg.file %}
                        <a href="{{ msg.file.url }}" class="block mt-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-2xl font-bold text-center hover:shadow-xl transition transform hover:scale-105" download>
                            Download File
                        </a>
                    {% endif %}
                    <p class="text-xs text-gray-500 mt-2 text-right">
                        {{ msg.timestamp|time:"H:i" }}
                        {% if msg.is_read and msg.sender == request.user %}
                            <i class="fas fa-check-double text-blue-600 ml-1"></i>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="text-center text-gray-500 py-20">
            <i class="fas fa-comment-slash text-6xl mb-4"></i>
            <p class="text-2xl">No messages yet</p>
            <p>Start the conversation!</p>
        </div>
        {% endfor %}
    </div>

    <!-- Message Input -->
    <form method="post" enctype="multipart/form-data" class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-6">
        {% csrf_token %}
        <div class="flex items-center space-x-4">
            <label class="cursor-pointer text-3xl text-indigo-600 hover:text-indigo-700 transition">
                <input type="file" name="file" class="hidden">
                <i class="fas fa-paperclip"></i>
            </label>
            <input type="text" name="content" placeholder="Type a message..." 
                   class="flex-1 px-6 py-5 text-lg border-2 border-gray-300 dark:border-gray-600 rounded-full focus:border-indigo-500 dark:bg-gray-700 focus:ring-4 focus:ring-indigo-200 outline-none transition">
            <button type="submit" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-purple-600 hover:to-pink-600 text-white font-bold text-2xl w-16 h-16 rounded-full shadow-2xl transition transform hover:scale-110">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </form>
</div>
{% endblock %}